<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-N96SR2');</script>
    <!-- End Google Tag Manager -->

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-KKTZ7CB');</script>
    <!-- End Google Tag Manager -->
    
    <title>Community Presence Map | British Red Cross</title>

    <!--[if lte IE 8]><script type="text/javascript" src="js/excanvas.min.js"></script><![endif]-->

    <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat" type="text/css" /> -->
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" />
    <!-- <link rel="stylesheet" href="css/leaflet.min.css" /> -->

    <link rel="stylesheet" href="css/leaflet-sidebar.min.css" />
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" integrity="sha256-EFpFyBbuttUJtoocYzsBnERPWee2JYz4cn5nkUBjW0A=" crossorigin="anonymous" /> -->

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.2.0/css/all.css" integrity="sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/bootstrap-slider.min.css" />
    <link rel="stylesheet" href="css/funkyradio.min.css" />

    <!-- <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script> -->
    <script src="https://cdn.polyfill.io/v2/polyfill.js?features=Array.prototype.map,Array.prototype.includes,Object.values"></script>

    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script> -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="js/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>

    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <!-- <script src="js/leaflet-src.js"></script> -->

    <script src="js/leaflet-sidebar.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js" integrity="sha256-iwOC2Y7nazcGcp6/ssCIuZviWKow9gVN5ntSdgI0jQc=" crossorigin="anonymous"></script> -->

    <!-- Tile caching
    <script src="https://unpkg.com/pouchdb@^5.2.0/dist/pouchdb.js"></script>
    <script src="https://unpkg.com/leaflet.tilelayer.pouchdbcached@latest/L.TileLayer.PouchDBCached.js"></script>
    -->

    <script type="text/javascript" src="js/webgl-heatmap/webgl-heatmap.js"></script>
    <script type="text/javascript" src="js/leaflet-webgl-heatmap.min.js"></script>
    <script type="text/javascript" src="js/bootstrap-slider.min.js"></script>
    <script type="text/javascript" src="js/leaflet.edgebuffer.min.js"></script>
    <script src="https://unpkg.com/leaflet.vectorgrid@latest/dist/Leaflet.VectorGrid.bundled.js"></script>



    <style>
        body {
            position: fixed;
            top: 0;
            left: 0;
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }

        html, body, #map {
            font: 10pt "Montserrat", "Helvetica Neue", Arial, Helvetica, sans-serif;
        }

        .map {
            position: relative;
            height: 100%;
            width: 100%;
            outline: none;
            touch-action: none;
            background-color: #ffffff;
            position: relative;
        }

        .sidebar-content {
            background-color: rgba(255, 255, 255, 0.8);
        }

        .sidebar {
            /* width: 400px; */
            max-width: 400px;
        }

        .sidebar-pane {
            min-width: 0px;
        }

        .select2-dropdown {
            z-index: 99999;
        }
        /*
        .select2-container .select2-search--inline:only-child {
            float: none;
        }
        */

        .slider-tick-label-container {
            margin-left: -13.125px;
        }

        .awesomeIcon {
            text-align: center; /* Horizontally center the text (icon) */
            line-height: 20px; /* Vertically center the text (icon) */
        }

        /* for  checked list group. Source: https://bootsnipp.com/snippets/featured/checked-list-group */
        .state-icon {
            /* left: -5px; */
            margin-right: 5px;
        }
        .list-group-item-primary {
            color: rgb(255, 255, 255);
            background-color: rgb(66, 139, 202);
        }

        .list-group-item-indent {
            padding-left: 30px;
        }
        
        /*
         * styling for external data 
         * from: https://leafletjs.com/examples/choropleth/
         */
        .info {
            padding: 6px 8px;
            font: 14px/16px Arial, Helvetica, sans-serif;
            background: white;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
        }
        .info h4 {
            margin: 0 0 5px;
            color: #777;
        }
        .legend {
            line-height: 18px;
            color: #555;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KKTZ7CB"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" id="tabhome" role="tab" title="Community Presence Map" data-toggle="popover" data-trigger="hover" data-placement="right" data-content="Click here to get started"><i class="fa fa-question"></i></a></li>
                <li><a href="#people" id="tabpeople" role="tab" data-toggle="popover" data-trigger="hover" data-placement="right" data-content="Staff and volunteers"><i class="fa fa-user"></i></a></li>
                <li><a href="#services" id="tabservices" role="tab" data-toggle="popover" data-trigger="hover" data-placement="right" data-content="Services, shops, properties"><i class="fa fa-plus-square"></i></a></li>
                <!-- <li><a href="#layers" id="tablayers" role="tab" data-toggle="popover" data-trigger="hover" data-placement="right" data-content="External data"><i class="fa fa-globe-africa"></i></a></li> -->
                <li><a href="#risk" id="tablayers" role="tab" data-toggle="popover" data-trigger="hover" data-placement="right" data-content="Risks"><i class="fa fa-globe-africa"></i></a></li>
                <li><a href="#settings" id="tabsettings" role="tab" data-toggle="popover" data-trigger="hover" data-placement="right" data-content="Other settings"><i class="fa fa-cog"></i></a></li>
            </ul>

            <!-- will implement the download button later
            <ul role="tablist">
                <li><a href="#download" id="download" role=""><i class="fa fa-download"></i></a></li>
            </ul>
            -->
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    Community Presence Map
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
                <br/>
                <p>The Community Presence Map shows where the British Red Cross currently operates in the UK.</p>
                <p>When you open the webpage, you will see two heatmaps: green represents our volunteers and blue is our staff.</p>
                <p>This section contains some introductory information about the Community Presence Map. There is also <a href="help.html" target="_blank">a more comprehensive guide available to read</a>.</p>
                <h5>Using this map</h5>
                <p>The menu to the left of this message contains a set of options you can use to customise the map. Click the <i class="fa fa-caret-left"></i> icon in the top-right corner to hide this sidebar so you can see more of the map.</p>
                <p><i class="fa fa-user"></i> contains different options for displaying information about staff and volunteers. You can choose to show or hide both heatmaps. For volunteers, you can choose whether to display volunteer roles or only individual people (one person can have multiple roles). For staff, you can choose to show only people whose roles are between particular levels.</p>
                <p><i class="fa fa-plus-square"></i> lets you filter what you see by BRC service or directorate, and also lets you see where our services, shops and other properties are located. Services include only those listed on our main website, so several will be missing.</p>
                <p><i class="fa fa-globe-africa"></i> will let you add individual risks and overlapping risks to the map .</p>
                <p><i class="fa fa-cog"></i> lets you change the radius drawn around each person on the volunteer and staff heatmaps. By default, each person has a 25km radius drawn around them.</p>
                <h5>More information</h5>
                <p>There are more interactive maps available on the <a href="http://data.redcross.org.uk" target="_blank">Insight &amp; Improvement Data Hub</a>.</p>
                <!-- <p>Add a tracker for bugs and feature requests</p> -->
                <p>This map is developed and maintained by <a href="mailto:MattThomas@redcross.org.uk">Matt Thomas</a>. Please get in touch if you have any comments, questions or suggestions.</p>
                <h5>Data last updated on...</h5>
                <p>Volunteers: September 2018<br/>
                CRVs: September 2018<br/>
                Staff: September 2018<br/>
                Services: August 2018<br/>
                Properties: June 2018</p>
            </div>

            <div class="sidebar-pane" id="people">
                <h1 class="sidebar-header">Staff and volunteers<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <br/>
                <div class="panel panel-default" id="controls">  <!-- style="top:70px;left:10px;width:225px;position:absolute;"> -->
                    <h5>Volunteers heatmap</h5>
                    <div id="show_vols" class="form-group">
                        <label class="control-label" for="show_vols">Show:</label>
                        <div>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="show_vols" value="None"/>
                                    <span>Nobody</span>
                                </label>
                            </div>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="show_vols" value="Roles" checked="checked"/>
                                    <span>Roles</span>
                                </label>
                            </div>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="show_vols" value="People"/>
                                    <span>People</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" for="vol_options">Volunteer basis:</label>
                        <div>
                            <select id="vol_options">
                                <option value="All" selected>All</option>
                                <option value="Regular">Regular</option>
                                <option value="Occasional">Occasional</option>
                                <option value="Skills Gap Outstanding">Skills gap</option>
                            </select>
                        </div>
                    </div>
                    <br/>
                    <h5>Staff heatmap</h5>
                    <div id="show_staff" class="form-group">
                        <label class="control-label" for="show_staff">Show:</label>
                        <div>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="show_staff" value="none"/>
                                    <span>Nobody</span>
                                </label>
                            </div>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="show_staff" value="all" checked="checked"/>
                                    <span>All grades</span>
                                </label>
                            </div>
                            <div class="radio">
                                <label>
                                    <input type="radio" name="show_staff" value="levels"/>
                                    <span>Between role grades<br/>(drag the slider)</span><br/><br/>
                                    <input id="staff_level"/>
                                </label>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <h5>Include staff and volunteers who work in...</h5>
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                <input id="show_uko" type="checkbox"/>
                                <span>UK Office</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                <input id="show_ssc" type="checkbox"/>
                                <span>Shared Service Centre</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                <input id="show_rct" type="checkbox"/>
                                <span>Red Cross Training</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-pane" id="services">
                <h1 class="sidebar-header">Services and buildings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <br/>

                <h5>Show BRC's...</h5>
                <div class="form-group">
                    <div class="checkbox">
                        <label>
                            <input id="show_servs" type="checkbox"/>
                            <span>Services</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="checkbox">
                        <label>
                            <input id="show_props" type="checkbox"/>
                            <span>Properties</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="checkbox">
                        <label>
                            <input id="show_shops" type="checkbox"/>
                            <span>Shops</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <div class="checkbox">
                        <label>
                            <input id="show_cc" type="checkbox"/>
                            <span>Community Connector sites</span>
                        </label>
                    </div>
                </div>

                <br/>

                <h5>Filter by services and other BRC directorates:</h5>
                <!--<div class="form-group">
                    <select id="division" multiple="multiple" class="division-select form-control" name="divisions[]" style="width: 300px">
                        <option></option>
                    </select>
                </div>-->

                <div class="well" style="overflow: auto;">  <!-- max-height: 300px; -->
                    <ul id="check-list-box" class="list-group checked-list-box">
                        <li class="list-group-item list-group-item-check">Chief Executive's Office</li>
                        <li class="list-group-item list-group-item-check">Communications &amp; Engagement</li>
                        <li class="list-group-item list-group-item-check">Finance Planning &amp; Resources</li>
                        <li class="list-group-item"><b>Fundraising</b></li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Community Fundraising</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Fundraising</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Retail</li>
                        <li class="list-group-item list-group-item-check">Information and Digital Technology</li>
                        <li class="list-group-item list-group-item-check">International</li>
                        <li class="list-group-item list-group-item-check">People &amp; Learning</li>
                        <li class="list-group-item list-group-item-check">Strategic Change</li>
                        <li class="list-group-item"><b>UK Operations</b></li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Ambulance Support</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Community Equipment Services</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Crisis Response</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">CRV</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Education</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Event First Aid</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Independent Living</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Innovation and Insight</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Mobility Aids</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Refugee Support</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">Restoring Family Links</li>
                        <li class="list-group-item list-group-item-check list-group-item-indent">UK Ops Finance, HR etc.</li>
                    </ul>
                </div>
            </div>

            <div class="sidebar-pane" id="risk">
                <h1 class="sidebar-header">Risks/vulnerabilities<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <br/>
                <p>Choose the risks/vulnerabilities you want to show on the map:</p>
                <p>(Currently displaying <span id="nRiskyLADs">0</span> Local Authorities)</p>

                <fieldset>
                    <h5>Disasters/emergencies:</h5>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_fire" name="show_risks" value="Fires"/>
                        <label for="show_risks_fire">Fires</label>
                    </div>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_flood" name="show_risks" value="Flooding"/>
                        <label for="show_risks_flood">Flooding</label>
                    </div>
                    <br/>
                    <h5>Displacement:</h5>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_asylum" name="show_risks" value="Displacement"/>
                        <label for="show_risks_asylum">Asylum seeker displacement</label>
                    </div>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_mig" name="show_risks" value="Migrant destitution"/>
                        <label for="show_risks_mig">Migrant destitution</label>
                    </div>
                    <br/>
                    <h5>Health/social care:</h5>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_hle" name="show_risks" value="Healthy life expectancy"/>
                        <label for="show_risks_hle">Healthy life expectancy</label>
                    </div>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_loneliness" name="show_risks" value="Loneliness"/>
                        <label for="show_risks_loneliness">Loneliness</label>
                    </div>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_health" name="show_risks" value="Health deprivation"/>
                        <label for="show_risks_health">Health deprivation</label>
                    </div>
                    <br/>
                    <h5>Connectedness:</h5>
                    <div class="form-row">
                        <input type="checkbox" id="show_risks_digital" name="show_risks" value="Digital exclusion"/>
                        <label for="show_risks_digital">Digital exclusion</label>
                    </div>
                </fieldset>
            </div>

            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
                <br/>
                <div class="form-group">
                    <label class="control-label" for="radius">Radius for staff and volunteer heatmaps (km):</label><br/><br/>
                    <input id="radius"/><br/><br/>
                    <span id="radiusLabel">Current radius: <span id="radiusVal">25</span>km</span>
                </div>
                <br/>
                <h5>Transparency of heatmaps</h5>
                <div class="form-group">
                    <label class="control-label" for="opacityVols">Volunteers:</label><br/><br/>
                    <input id="opacityVols"/><br/><br/>
                    <span id="opacityVolsLabel">Current transparency: <span id="opacityVolsVal">30</span>%</span>
                </div>
                <div class="form-group">
                    <label class="control-label" for="opacityStaff">Staff:</label><br/><br/>
                    <input id="opacityStaff"/><br/><br/>
                    <span id="opacityStaffLabel">Current transparency: <span id="opacityStaffVal">30</span>%</span>
                </div>
            </div>
        </div>
    </div>

    <div id="map" class="map"></div>

    
    <!-- load data -->
    <script src="data/vols.js"></script>
    <script src="data/staff.js"></script>
    <script src="data/divisions2.js"></script>
    <script src="data/services_new.js"></script>
    <script src="data/shops.js"></script>
    <script src="data/props.js"></script>
    <script src="data/cc.js"></script>
    <!-- script src="data/loneliness.js"></script> -->

    <script src="data/lad-risk.js"></script>
    
    <!-- main map script -->
    <script src="js/map.js"></script>
    <!-- <script src="js/imd.js"></script> -->
    
</body>
</html>